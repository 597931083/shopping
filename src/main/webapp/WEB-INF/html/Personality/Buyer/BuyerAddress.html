<!--收货地址-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit|ie-stand" />
    <meta charset="utf-8" />
    <title>汽配人会员中心</title>
    <link href="../../static/css/css_base.css" rel="stylesheet" />
    <link href="../../static/css/css_top.css" rel="stylesheet" />
    <link href="../../static/css/hayui.css" rel="stylesheet" />
    <link href="../../static/css/leagueradmin-nav-sidemenu.css" rel="stylesheet" />
    <link href="../../static/css/css_buy_sc.css" rel="stylesheet" />
    <link href="../../static/css/artdialog.css" rel="stylesheet" />
    <link href="../../static/css/css_user.css" rel="stylesheet" />
    <link href="../../static/css/user-center.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/base.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/myjd.easebuy.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/../../static/css/bootstrap.min.css">

    <script src="../../static/js/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="../../static/js/bootstrap.js" type="text/javascript"></script>
    <script src="../../static/js/Region.js" type="text/javascript"></script>
    <script src="../../static/js/CommonJS.js" type="text/javascript"></script>
    <script src="../../static/js/hayui.js" type="text/javascript"></script>
    <script src="../../static/template/admin/js/sysUtils.js" type="text/javascript"></script>
    <Rscript src="../../static/template/admin/js/template-web.js" type="text/javascript"></Rscript>
    <style>
        #edit-cont *{box-sizing:content-box;}
        .hide-none{display:none;}
        .m, .mt, .mc, .mb, .sm, .smt, .smc, .smb {
            overflow: hidden;
            zoom: 1;
        }
        .border-box {
            float: none;
            width: auto;
        }
    </style>

    <script type="text/javascript">
        $(function () {
            AddressFormat();
        });
        var AddressFormat = function(){
            $.ajax({
                url: '/address/useraddress',
                type: "post",
                dataType: "json",
                success: function(data){
                    $("#order_box").append(template("addressFormat",{list:data}));
                }
            });
        };
    </script>

<body class="hayui-bg-gray-light">

<div class="lh24">
    <div class="title bot-border">
        <h3 class="title_txt cur">收货地址管理</h3>
    </div>

    <script type="text/html" id="addressFormat">
        {{each list data}}
        <div id="6670" class="sm easebuy-m">
            <div class="smt">
                <h3>{{data.linkman}}</h3>
                <div class="extra">
                    <a class="btn-9 id_edit" onclick="editad('"+ {{data.id}} +"')" href="javascript:;" data="6670">编辑</a>
                    <a class="btn-9 del" onclick="deleltead('"+ {{data.id}} +"')" href="javascript:;" data-tag="6670">删除</a>
                </div>
            </div>
            <div class="smc">
                <div class="items new-items">
                    <div class="item-lcol">
                        <div class="item">
                            <span class="label">收货人：</span>
                            <div class="fl" id="linkman-{{data.id}}">{{data.linkman}}</div>
                            <span class="clr"></span>
                        </div>
                        <div class="item">
                            <span class="label">所在地区：</span>
                            <div class="fl" data="1529,1564,1570" id="fullregion-{{data.id}}">{{data.province}} {{data.city}} {{data.area}}</div>
                            <span class="clr"></span>
                        </div>
                        <div class="item">
                            <span class="label">地址：</span>
                            <div class="fl" id="detailedaddress-{{data.id}}">{{data.detailedaddress}}</div>
                            <span class="clr"></span>
                        </div>
                        <div class="item">
                            <span class="label">手机号码：</span>
                            <div class="fl" id="tel-{{data.id}}">{{data.tel}}</div>
                            <span class="clr"></span>
                        </div>
                    </div>
                    <div class="item-rcol">
                        <div class="extra">
                            <a class="btn-5 update-eshop e-btn" data="6670" style="display:none;">升级为轻松购</a>

                        </div>
                    </div>
                    <div class="clr"></div>
                </div>
            </div>
        </div>
        {{/each}}
    </script>

    <!-- 按钮触发模态框 -->
    <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#edit-cont">
        新增收货地址
    </button>
    你已创建0个收货地址，还可以创建20个

    <div class="mc pd10" id="order_box">

    </div>
</div>



<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- 模态框（Modal） -->
<div class="modal fade" id="edit-cont" class="m" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog mc">
        <div class="modal-content form">
            <div class="modal-header item">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h6 class="modal-title" id="myModalLabel">
                    新增收货地址
                </h6>
            </div>
            <div class="modal-body item">
                <div style="width: 450px; padding-left: 10px; padding-right: 10px;" id="" class="thickcon">
                    <div id="addressDiagDiv">
                        <input type="hidden" value="false" id="isDefault">
                        <input type="hidden" value="0" id="update_paymentId">
                        <input type="hidden" value="0" id="update_pickId">
                        <input type="hidden" value="" id="update_pickName">
                        <div id="edit-cont" class="m">
                            <div class="mc">
                                <div class="form">
                                    <div class="item">
                                        <span class="label"><em>*</em>收货人：</span>
                                        <div class="fl">
                                            <input type="hidden" value="" id="consigneeid">
                                            <input type="text" class="text" value="" id="consigneeName">
                                            <span class="error-msg hide-none" id="consigneeNameNote">请您填写收货人姓名</span>
                                        </div>
                                        <div class="clr"></div>
                                    </div>
                                    <div class="item info">
                                        <span class="label"><em>*</em>所在地区：</span>
                                        <div class="fl">
                                            <select id="s_province" class="sele" name="s_province"  style="width: 100px;"></select>  

                                            <select id="s_city" name="s_city" class="sele" style="width: 100px;" ></select>  

                                            <select id="s_county" name="s_county" class="sele" style="width: 100px;"></select>

                                            <span id="areaNote" class="error-msg  hide-none">请您填写完整的地区信息</span>
                                        </div>
                                        `								<script src="../../static/js/area.js"></script>
                                        <script type="text/javascript">_init_area();</script>
                                        <div class="clr"></div>
                                    </div>
                                    <div class="item">
                                        <span class="label"><em>*</em>详细地址：</span>
                                        <div class="fl">
		                                    <span id="areaName" style="float: left;margin-right: 5px;line-height:32px;">
		                                        <span></span><span></span><span></span>
		                                    </span>
                                            <input type="text" class="text text1" value="" id="consigneeAddress">
                                        </div>
                                        <span id="consigneeAddressNote" class="error-msg hide-none">请您填写收货人详细地址</span>
                                        <div class="clr"></div>
                                    </div>
                                    <div class="item">
                                        <div class="fl">
                                            <span class="label"><em>*</em>手机号码：</span>
                                            <input type="text" class="text" maxlength="20" value="" id="consigneeMobile">
                                            <span id="consigneeMobileNote" class="error-msg hide-none">请您填写收货人手机号码</span>
                                            <span class="clr"></span>
                                        </div>
                                        <div class="clr"></div>
                                    </div>
                                    <div class="btns">
                                        <a id="id_add_order" class="e-btn btn-5 save-btn" href="javascript:;">保存收货地址</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

</div>
<script type="text/javascript">
    var deletead = function(id){
        $.dialog.confirm('您确定要删除该收货地址吗？', function () {
            var loading = showLoading();
            $.post('/address/deladdress', { id: id }, function (result) {
                loading.close();
                if (result.success) {

                }
                else
                    $.dialog.errorTips(result.msg);
            });
        });
    }
    var editad = function(id){
        var linkman = document.getElementById("linkman-"+id).innerText;
        var detailedaddress = document.getElementById("detailedaddress-"+id).innerText;
        var fullregion = document.getElementById("fullregion-"+id).innerText;
        var tel = document.getElementById("tel-"+id).innerText;
        var adid = id;
        var arr = fullregion.split(' ');
        $('#consigneeid').val(adid);
        $('#consigneeName').val(linkman);
        $('#s_province').val(arr[0]);
        $('#s_province').trigger('change');
        $('#s_city').val(arr[1]);
        $('#s_city').trigger('change');
        $('#s_county').val(arr[2]);
        $('#s_county').trigger('change');
        $('#consigneeAddress').val(detailedaddress);
        $('#consigneeMobile').val(tel);

    }
    var isSelectAddr = function () {

        var haveProvince = ($("#s_province").val() == "省份")?false:true;
        var haveCity = ($("#s_city").val() == "地级市")?false:true;
        var haveCounty = ($("#s_county").val() == "市、县级市")?false:true;

        return haveProvince && haveCity && haveCounty;
    };
    var telRule = function (string) {
        var pattern = /^1[34578]\d{9}$/;
        if (pattern.test(string)) {
            return true;
        }

        return false;
    };

    $('#consigneeName').blur(function () {
        var str = $.trim($(this).val());
        if (str) {
            $('#consigneeNameNote').hide();
        } else {
            $('#consigneeNameNote').show();
        }
    });
    $('#consigneeAddress').blur(function () {
        var str = $(this).val();
        if (str) {
            $('#consigneeAddressNote').hide();
        } else {
            $('#consigneeAddressNote').show();
        }
    });
    $('#consigneeMobile').blur(function () {
        var str = $(this).val(),
            bool = telRule(str);
        if (bool) {
            $('#consigneeMobileNote').hide();
        } else {
            $('#consigneeMobileNote').show();
        }
    });

    $('#id_add_order').bind('click', function () {
        var adid = $('#consigneeid').val();
        consigneeName = $.trim($('#consigneeName').val()),
            province = $('#s_province').val(),
            city = $('#s_city').val(),
            county = $('#s_county').val(),
            consigneeAddress = $('#consigneeAddress').val(),
            consigneeMobile = $('#consigneeMobile').val();
        bool = ($(this).attr('data')) ? $(this).attr('data').split(',') : '',
            valArr = [consigneeName, province + ' ' + city + ' ' + county, consigneeAddress, consigneeMobile];
        if (consigneeName) {
            $('#consigneeNameNote').hide();
        } else {
            $('#consigneeNameNote').show();
            //return;
        }

        if (!isSelectAddr()) {
            $('#areaNote').show();
            //return;
        }
        else {
            $('#areaNote').hide();
        }

        if ($.trim(consigneeName).length == 0) {
            $('#consigneeNameNote').show();
            //return;
        }
        if ($.trim(consigneeAddress).length == 0) {
            $('#consigneeAddressNote').show();
            //return;
        }
        if (consigneeAddress) {
            $('#consigneeAddressNote').hide();
        } else {
            $('#consigneeAddressNote').show();
            //return;
        }

        var str = $("#consigneeMobile").val(),
            bool = telRule(str);
        if (!bool) {
            $('#consigneeMobileNote').show();
            //return;
        } else {
            $('#consigneeMobileNote').hide();
        }
        $.post('/address/saveorupdateaddress', {addressid:adid,linkman:consigneeName,
            tel:consigneeMobile,detailedaddress:consigneeAddress,province:province,city:city,area:county}, function (result) {
            loading.close();
            if(result.SUCCESS){
                $.dialog.tips('保存成功');
            }
        })
        $('#consigneeid').val('');
        $('#consigneeName').val('');
        $('#s_province').val('省份');
        $('#s_province').trigger('change');
        $('#s_city').val('地级市');
        $('#s_city').trigger('change');
        $('#s_county').val('市、县级市');
        $('#s_county').trigger('change');
        $('#consigneeAddress').val('');
        $('#consigneeMobile').val('');
        $("#edit-cont").modal('hide');
    });

</script>
</body>
</html>
